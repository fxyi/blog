# 一 绪论

## 1.2

### 1.2.3 数据模型

- 概念模型
- 逻辑模型
- 物理模型



### 1.2.4 最常用的数据模型

**逻辑模型**

- 层次模型：树形结构，组织架构图，家族族谱
- 网状模型：图形结构，工程图
- 关系模型：表格
- 面向对象模型
- 对象关系模型

层次模型和网状模型又叫做格式化模型



### 1.2.5 关系模型

#### 1、关系模型的数据结构

- 关系：对应一张表
- 元组：表中的一行，一条数据/记录
- 属性：表中的一列
- 码：键，可以唯一确定一个元组的属性
- 域：属性的取值范围/集合
- 分量：元组中的一个属性值
- 关系模式：对关系的描述，关系名(属性1，属性2，属性n)

#### 2、关系模型的操作与完整性约束

- 操作：查询，插入，删除，更新
- 完整性约束原则
  - 实体完整性
  - 参照完整性
  - 用户定义的完整性

#### 3、关系模型的优点

1. 与格式化模型不同，关系模型是建立在严格的数学概念基础上的
2. 概念单一
3. 存取路径对用户透明，具备数据独立性、安全保密性



## 1.3 数据库系统结构

### 1.3.1 模式的概念

模式（schema）：全体数据的逻辑结构和特征的描述



### 1.3.2 三级模式和两级映像

- 三级模式
  1. 外模式 - 应用/用户模式，视图
  2. 模式 - 概念/逻辑模式，实际数据库中是如何存储的，表长啥样
  3. 内模式 - 物理/存储模式，物理存储，数据索引
- 两级映像：两种模式间的转换
  1. 内模式/模式映像
  2. 外模式/模式映像



### 1.3.3 数据独立性

三级模式和两级映像保证了数据的独立性



## 1.4 数据库系统的组成

1. 数据库
2. 数据库管理系统（及其开发工具）
3. 应用系统
4. 数据库管理员



# 二 关系数据库

## 2.1 关系数据结构及形式化定义

### 2.1.1 关系

现实世界中的实体，实体间的联系，都可以用关系来表示

逻辑结构是一张二维表

关系模型是建立在集合代数的基础上的

1. 域：属性的取值范围/集合
2. 笛卡尔积：给定一组域，所有域的所有取值的一个组合。很多数据没有实际意义
   - 元组 t：表中的一行，一条数据/记录
   - 分量：元组中的一个属性值
   - 基数：元组的个数，记录的条数
   - 目/度 n：属性的个数
3. 关系：R(D1,D2,D3,Dn)
   - 单元关系：n=1，1个属性
   - 二元关系：n=2，2个属性
   - 码
     - 候选码：凡是可以唯一确定一条记录的属性/属性组，比如学号、身份证号
     - 全码：极端情况，表中所有属性才能决定一条记录
     - 主码：从候选码中选一个作为主码
     - 主属性：就是候选码
     - 非主属性：不是候选码的
   - 三类关系/表
     - 基本表：实际存储的表，其他都是虚拟表
     - 查询表：查询结果对应的表
     - 视图表：由基本表或其他视图表导出的表
   - 基本关系的性质



### 2.1.2 关系模式

关系模式是对关系的描述

- 关系：R(D1,D2,D3,Dn)
- 关系模式：R(U,D,DOM,F)
  - U：属性名集合
  - D：属性域的集合
  - DOM：U和D之间的映像关系
  - F：属性间的数据依赖关系
- 关系模式是静态的，关系的动态的



### 2.1.3 关系数据库

- 型：关系数据库的定义
- 模式：若干域的定义
- 值



### 2.1.4 关系模型的存储结构

1. 一个表对应一个操作系统文件
2. 自己组织表、索引等存储结构



## 2.2 关系数据结构

### 2.2.1 基本关系操作

1. 常用的关系操作
   1. 查询：选择、投影、连接、除、并、交、差
      - 5种基本操作：选择、投影、并、差、笛卡尔积
   2. 数据更新：插入、删除、修改
2. 关系操作的特点：集合的操作方式



### 2.2.2 关系数据库语言的分类

1. 关系代数：用对关系的运算来表达查询要求，如 ISBL
2. 关系演算语言：用谓词来表达查询要求
   1. 元组关系演算语言：APLHA
   2. 域关系演算语言：QBF
3. 具有关系代数和关系演算语言双重特点的语言：SQL



## 2.3 关系的完整性

关系的两个不变性，必须满足：实体完整性，参照完整性

**三类完整性约束**

1. 实体完整性
2. 参照完整性
3. 用户定义的完整性



### 2.3.1 实体完整性

主属性不能取空，不能相同



### 2.3.2 参照完整性

1. 关系间的引用
2. 外码
   1. 参照关系
   2. 被参照关系/目标关系
3. 参照完整性规则
   1. 外码可以是空



### 2.3.3 用户定义的完整性

现实世界的语义要求



## 2.4 关系代数

关系代数是一种抽象的查询语言

运算的对象是关系/表，结果也是关系/表

根据运算符的不同进行分类

- 集合运算：从关系的水平方向
  - 并
  - 差
  - 交
  - 笛卡尔积
- 专门的关系运算：涉及行和列
  - 选择
  - 投影
  - 连接：从两个关系的笛卡尔积中选出满足条件的元组
  - 除



### 2.4.1 传统的集合运算

两个结构一样的表

1. 并：R+S，数据在R里，也在S里
2. 差：R-S，数据在R里，不在S里
3. 交：R∩S，数据在R里，不在S里
4. 笛卡尔积：两个结构可以不一样的表，R✖️S
   1. 结果的列数是R的列数+S的列数
   2. 结果的元组个数为R的元组个数*S的元组个数




### 2.4.2 专门的关系运算

关系R(A1,A2,A3,An)

t是R的一个元组

1. 选择：选择符合条件的元组
2. 投影：选择指定列，返回不重复的可选值
3. 连接：从两个关系的笛卡尔积中选出满足条件的元组
   1. 等值连接
   2. 自然连接：要求相等的两个属性名要相等
4. 除
   1. R(X,Y) ➗ S(Y,Z) = P(X)

**四个概念**

- 悬浮元组：两个关系R和S在进行自然连接时，不符合要求被舍弃的元组
- 外连接：悬浮元组也保存到结果中，其他属性为null
- 左外连接：只保留R的悬浮元组
- 右外连接：只保留S的悬浮元组



## 2.5 关系演算

理论上的推导研究

关系演算是以数理逻辑中的谓词演算为基础的

- 元组关系演算
- 域关系演算



### 2.5.1 元组关系演算语言： ALPHA

1. 检索操作：**GET**查询
   1. 简单检索（不带条件）
   2. 限定检索（带条件）
   3. 带排序的检索（DOWN降序，UP升序）
   4. 指定返回元组的个数
   5. 用元组变量的检索
      1. 简化关系名，重命名
      2. 操作条件中使用量词必须用元组变量
      3. ALPHA语言用RANGE来说明元组变量
   6. 用存在量词的检索条件中使用量词时必须使用元组变量
   7. 多个关系的表达式的检索
   8. 用全称量词的检索
   9. 用两种量词的检索
   10. 用蕴含的检索
   11. 聚集函数
       1. count：会自动排除重复值
       2. total
       3. max
       4. min
       5. avg
2. 更新操作
   1. 修改操作（并发）
      1. 首先用**HOLD**语句将修改的元组从数据库中读取到工作空间中，HOLD有并发控制（锁），其他程序无法访问该数据
      2. 在工作空间中，用宿主语言修改元组属性：**MOVE**语句
      3. 用**UPDATE**语句将修改后的元组送回数据库
      4. HLOLD和GET的关系：HOLD是带有并发的GET语句
   2. 插入操作
      1. 用宿主语言MOVE语句，在工作空间中创建新的元组
      2. **PUT**将元组存入数据库
   3. 删除操作
      1. HLOD语句把要删除的元组从数据库中读到工作空间中
      2. **DELETE**删除该元组：删工作空间，删除数据库，解锁
3. DROP：删表



### 2.5.2 元组关系演算



### 2.5.3 域关系演算语言QBE


# 三 关系数据库标准语言SQL


